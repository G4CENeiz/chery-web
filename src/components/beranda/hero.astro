---
import Car from "../../data/main-car.json";
import HeroLeft from "../beranda/left/heroleft.astro";
import Image from "../beranda/right/image.astro";
---
<div
  x-data=`{
    cars: ${JSON.stringify(Car.cars)},
    currentCarIndex: 0,
    visibleCars() {
      const count = this.cars.length;
      const current = this.currentCarIndex;
      const prev = (current - 1 + count) % count;
      const prevTwo = (current - 2 + count) % count;
      const next = (current + 1) % count;
      const nextTwo = (current + 2) % count;
      return [prevTwo, prev, current, next, nextTwo];
    },
    currentCar() { return this.cars[this.currentCarIndex]; },
    nextCar() {
      this.currentCarIndex = (this.currentCarIndex + 1) % this.cars.length;
    },
    prevCar() {
      this.currentCarIndex = (this.currentCarIndex - 1 + this.cars.length) % this.cars.length;
    },
    setCar(index) {
      this.currentCarIndex = index;
    }
  }`
  class="relative min-h-screen px-4 sm:px-10"
>
<template x-for="(car, index) in cars" :key="index">
  <div
    class="absolute inset-0 w-full h-full bg-gray-300 transition-all duration-500 ease-in-out blur-sm sm:blur-sm"
    x-data="{ loaded: false }"
    :class="loaded ? 'bg-cover bg-center' : 'bg-gray-300'"
    x-show="currentCarIndex === index"
    x-transition:enter="transition ease-in-out duration-500"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition ease-in-out duration-500"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    x-init="
      let img = new Image();
      img.src = car.background;
      img.onload = () => { loaded = true; $el.style.backgroundImage = `url('${car.background}')`; }
    "
  ></div>
</template>
  <!-- Content container -->
  <div class="relative z-10 grid grid-cols-1 sm:grid-cols-2 gap-4 items-center text-center sm:text-left">
    <div class="absolute top-0 left-0 w-20 sm:w-32 h-1 bg-red-600 transform -rotate-45 origin-top-left"></div>
    <div class="relative px-4 sm:px-0">
      <HeroLeft />
    </div>
    <div class="relative px-4 py-20 sm:px-0">
      <Image />
    </div>
  </div>
</div>

